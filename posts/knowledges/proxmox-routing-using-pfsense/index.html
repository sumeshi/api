{"title": "proxmox-routing-using-pfsense", "heading": "pfSense\u3092\u4f7f\u3063\u305fProxmox\u306eVLAN\u8a2d\u5b9a", "path": "knowledges/proxmox-routing-using-pfsense", "html_text": "<h1>pfSense\u3092\u4f7f\u3063\u305fProxmox\u306eVLAN\u8a2d\u5b9a</h1>\n<p>\u304a\u3046\u3061\u30b5\u30fc\u30d0\u7528\u306b\u69cb\u7bc9\u3057\u305fProxmox\u306eVLAN\u8a2d\u5b9a\u306b\u3064\u3044\u3066</p>\n<h2>\u6982\u8981</h2>\n<p>Proxmox\u4e0a\u306b\u7acb\u3066\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u5206\u3051\u3066\u7ba1\u7406\u3057\u305f\u3044\u3002<br />\n\u5177\u4f53\u7684\u306b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002</p>\n<p><img alt=\"\" src=\"https://i.gyazo.com/ede80b9cf39c61f905adc300e7364234.png\" /></p>\n<p>192.168.0.0/24 \u914d\u4e0b\u306eProxmox\u30b5\u30fc\u30d0\u4e0a\u3067VLAN\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001192.168.10.0/24 \u3068 192.168.20.0/24 \u306e2\u3064(\u4ee5\u4e0a)\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u533a\u5207\u308b\u3002<br />\n\u305d\u3046\u3057\u305f\u3044\u7406\u7531\u3068\u3057\u3066\u306f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u5074\u304b\u3089 192.168.0.0/24 \u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307b\u3057\u304f\u306a\u304b\u3063\u305f\u308a\u3001192.168.0.10/24 \u3068 192.168.0.20/24 \u9593\u3067\u901a\u4fe1\u3057\u3066\u307b\u3057\u304f\u306a\u3044\u304b\u3089\u3002</p>\n<h2>\u624b\u9806</h2>\n<p>\u5927\u304d\u304f\u5206\u3051\u308b\u3068\u6b21\u306e\u3088\u3046\u306a\u611f\u3058\u3002</p>\n<ol>\n<li>Proxmox\u5074\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a</li>\n<li>pfSense\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</li>\n<li>pfSense\u306e\u8a2d\u5b9a</li>\n<li>\u4eee\u60f3\u30de\u30b7\u30f3\u5074\u306e\u8a2d\u5b9a</li>\n</ol>\n<h3>1. Proxmox\u5074\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a</h3>\n<ul>\n<li>\u30b5\u30a4\u30c9\u30d0\u30fc\u304b\u3089 Datacenter -&gt; pve \u3092\u30af\u30ea\u30c3\u30af</li>\n<li>pve\u306e\u30b5\u30a4\u30c9\u30d0\u30fc\u304b\u3089 System -&gt; Network\u3092\u30af\u30ea\u30c3\u30af</li>\n</ul>\n<p>\u30c7\u30d5\u30a9\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u308bvmbr0\u3068\u3044\u3046\u306e\u304c\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002VLAN-aware\u304c\u30ad\u30e2\u3002<br />\nIP\u30a2\u30c9\u30ec\u30b9\u3068\u304bNetwork Device\u306f\u9069\u5f53\u306b\u8aad\u307f\u66ff\u3048\u308b\u3053\u3068\u3002</p>\n<p><img alt=\"image\" src=\"https://user-images.githubusercontent.com/35072092/179372959-8e638aa8-4224-4167-81d9-51e0249fa827.png\" /></p>\n<h3>2. pfSense\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</h3>\n<p>https://www.pfsense.org/</p>\n<p>\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089ISO\u304c\u843d\u3068\u305b\u308b\u306e\u3067\u3001Proxmox\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u7acb\u3066\u308b\u3002\u30b9\u30da\u30c3\u30af\u306f\u9069\u5f53\u3002<br />\n\u8d77\u52d5\u3059\u308b\u3068\u8272\u3005\u805e\u304b\u308c\u308b\u3051\u3069\u3001\u57fa\u672c\u7684\u306b\u306f\u3044\u306f\u3044\u8a00\u3063\u3066\u308c\u3070\u3088\u3044\u3002</p>\n<h3>3. pfSense\u306e\u8a2d\u5b9a</h3>\n<p>\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001reboot\u304c\u7d42\u308f\u308b\u3068\u521d\u671f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u805e\u304b\u308c\u308b\u3002<br />\n\u4eca\u56de\u306f\u6b21\u306e3\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u305f\u3002</p>\n<p>WAN: 192.168.0.0/24<br />\nLAN1: 192.168.0.10/24\nLAN2: 192.168.0.20/24</p>\n<p>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4e00\u65e6pfSense\u306eFW\u8a2d\u5b9a\u3092\u7121\u52b9\u5316\u3059\u308b\u3002  </p>\n<pre><code>$ pfctl -d\n</code></pre>\n<p>\u305d\u3046\u3059\u308b\u3068WEBUI\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u306e\u3067\u3001\u3088\u3057\u306a\u306bFW\u8a2d\u5b9a\u3092\u3059\u308b\u3002<br />\n\u3068\u308a\u3042\u3048\u305a\u6700\u4f4e\u9650\u30bb\u30b0\u30e1\u30f3\u30c8\u9593\u306e\u30a2\u30af\u30bb\u30b9\u3092Block\u306b\u3057\u3066\u304a\u3051\u3070OK\u3002</p>\n<pre><code>LAN1:\n  Source: LAN1 net -&gt; Destination: WAN net\n  Source: LAN1 net -&gt; Destination: LAN2 net\n\nLAN2:\n  Source: LAN2 net -&gt; Destination: WAN net\n  Source: LAN2 net -&gt; Destination: LAN1 net\n</code></pre>\n<p>\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089Apply Configuration\u307f\u305f\u3044\u306a\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u8a2d\u5b9a\u304c\u53cd\u6620\u3055\u308c\u308b\u3002<br />\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066WEBUI\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u304a\u304f\u3053\u3068\u3002</p>\n<p>\u53c2\u8003: https://devblog.lac.co.jp/entry/20220413</p>\n<h3>4. VM\u306e\u8ffd\u52a0</h3>\n<p>\u3053\u3053\u307e\u3067\u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u308c\u3070\u3001\u3042\u3068\u306f\u5404\u30bb\u30b0\u30e1\u30f3\u30c8\u306bVM\u3092\u8ffd\u52a0\u3057\u3066\u3044\u3051\u3070\u3088\u3044\u3002<br />\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c0\u30d7\u30bf\u306e\u8a2d\u5b9a\u6642\u306b VLAN Tag \u3092\u8a2d\u5b9a\u3057\u3066\u3042\u3052\u308c\u3070\u81ea\u52d5\u3067\u305d\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306b\u8a2d\u5b9a\u304c\u3067\u304d\u308b\u3002</p>\n<p><img alt=\"image\" src=\"https://user-images.githubusercontent.com/35072092/183535336-9538c08f-fc48-4ccf-bcab-b3214c01c7f3.png\" /></p>\n<p>\u4e0a\u8a18\u306e\u753b\u50cf\u306f192.168.20.0/24\u914d\u4e0b\u306b\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306e\u4f8b\u3002</p>\n<h3>\u6240\u898b</h3>\n<p>VirtualBox\u307f\u305f\u3044\u306a\u4eee\u60f3SW\u3068\u304b\u8ffd\u52a0\u3057\u3066\u697d\u306b\u3067\u304d\u308b\u304b\u306a\uff5e\u3068\u601d\u3063\u305f\u3051\u3069\u5168\u7136\u305d\u3093\u306a\u3053\u3068\u306a\u304b\u3063\u305f\u3002<br />\n\u4f55\u5e74\u304b\u524d\u306bESXi+vyos\u3067\u3084\u3063\u305f\u3068\u304d\u3082\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u3057\u305f\u8a18\u61b6\u304c\u3042\u308b\u306e\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3061\u3083\u3093\u3068\u52c9\u5f37\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3055\u305d\u3046\u3002</p>\n<p>pfSense\u3067\u4e00\u53f0\u4eee\u60f3\u30de\u30b7\u30f3\u5c02\u6709\u3057\u3066\u308b\u3068\u304b\u3061\u3087\u3063\u3068\u30a2\u30db\u3063\u307d\u3044\u306e\u3067\u7269\u7406SW\u306b\u5909\u3048\u308b\u3068\u304b\u3001\u306a\u3093\u304b\u8003\u3048\u3088\u3046\u304b\u306a\u3002</p>\n<p>\u304a \u308f \u308a</p>", "published_at": "2022-08-09"}